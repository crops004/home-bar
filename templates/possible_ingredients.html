{% extends "base.html" %}
{% block title %}Possible Ingredients{% endblock %}
{% block content %}
    <div class="px-4 sm:px-6 pt-4 pb-24 sm:pt-0 sm:pb-8">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div>
            <h1 class="text-3xl font-semibold text-text-normal">Possible Ingredients</h1>
            <p class="text-sm text-text-muted">Manage the master ingredient list used across your bar and recipes.</p>
        </div>
        <button
            type="button"
            class="inline-flex items-center gap-2 rounded-full bg-logo px-4 py-2 text-sm font-medium text-light-text-normal hover:ring-2 hover:ring-logo transition"
            onclick="openAddModal()"
        >
            <span class="text-lg leading-none">+</span>
            Add Ingredient
        </button>
    </div>

    <div class="mt-6 bg-background-mid/40 border border-border rounded-2xl p-4">
        <div class="flex flex-col gap-1 w-full sm:max-w-sm">
            <div class="flex items-center justify-between gap-2">
                <label for="ingredient-filter" class="text-xs uppercase tracking-wide text-text-muted">Search Ingredients</label>
                <button
                    type="button"
                    id="ingredient-filter-clear"
                    class="text-xs font-semibold text-text-normal px-3 py-1 rounded-full border border-logo bg-background-light hover:bg-background-mid transition opacity-0 invisible pointer-events-none"
                    onclick="resetIngredientFilter(); toggleIngredientClear();"
                    aria-label="Clear search"
                >
                    Clear
                </button>
            </div>
            <div class="relative w-full">
                <input
                    type="text"
                    id="ingredient-filter"
                    placeholder=" Search by name, category, or subcategory..."
                    oninput="filterIngredientCards(); toggleIngredientClear();"
                    class="w-full rounded-lg border border-border bg-background-light pl-3 pr-16 py-2 text-base text-text-normal focus:outline-none focus:ring-2 focus:ring-logo"
                >
            </div>
        </div>
    </div>

    {% if ingredients %}
    <div id="ingredient-grid" class="mt-6 grid gap-4 sm:grid-cols-2 xl:grid-cols-3">
        {% for ingredient in ingredients %}
        <article
            class="ingredient-card ui-card ui-card-interactive"
            data-id="{{ ingredient['id'] }}"
            data-name="{{ ingredient['name'] }}"
            data-category="{{ ingredient['category'] or '' }}"
            data-subcategory="{{ ingredient['sub_category'] or '' }}"
        >
            <div class="p-4 space-y-3">
                <header class="flex items-start justify-between gap-3">
                    <h3 class="text-lg font-semibold text-text-normal truncate">{{ ingredient['name'] }}</h3>
                    <span class="text-xs text-text-muted bg-background-light px-2 py-1 rounded-full uppercase tracking-wide">{{ ingredient['category'] or 'Uncategorized' }}</span>
                </header>
                <div class="flex items-center justify-between gap-3">
                    <p class="text-sm text-text-muted">
                        <span class="font-medium text-text-normal">Subcategory:</span>
                        {{ ingredient['sub_category'] or 'None' }}
                    </p>
                    <div class="flex items-center gap-2 shrink-0">
                        <button
                            type="button"
                            class="inline-flex items-center gap-2 text-sm text-text-muted hover:text-logo transition"
                            onclick="openPriceModal(this)"
                        >
                            <span class="text-base leading-none">$</span>
                            Prices
                        </button>
                        <button
                            type="button"
                            class="inline-flex items-center gap-2 text-sm text-text-muted hover:text-logo transition"
                            onclick="openEditModal(this)"
                        >
                            <span class="text-base leading-none">✎</span>
                            Edit
                        </button>
                        <button
                            type="button"
                            class="inline-flex items-center gap-2 rounded-full bg-red-600 px-3 py-1 text-xs font-medium text-white hover:bg-red-500 transition"
                            onclick="deleteIngredient(this)"
                        >
                            Delete
                        </button>
                    </div>
                </div>
            </div>
        </article>
        {% endfor %}
    </div>
    <p id="ingredients-empty" class="mt-6 hidden text-sm text-text-muted">No ingredients match your search.</p>
    {% else %}
    <p class="mt-6 text-text-muted">No ingredients in the master list yet. Add your first ingredient above.</p>
    {% endif %}

    <!-- Add Ingredient Modal -->
    <div id="add-ingredient-modal" class="modal-backdrop hidden">
        <div class="modal-panel max-w-lg">
            <div class="modal-header">
                <h2 class="text-xl font-semibold text-text-normal">Add Ingredient</h2>
                <button type="button" onclick="closeAddModal()" class="text-text-muted hover:text-text-normal text-2xl leading-none">&times;</button>
            </div>
            <form method="post" class="modal-body space-y-4" id="add-ingredient-form">
                <label class="flex flex-col gap-1 text-sm">
                    <span class="modal-label">Name</span>
                    <input type="text" id="add-name" name="name" required class="modal-input" />
                </label>
                <label class="flex flex-col gap-1 text-sm">
                    <span class="modal-label">Category</span>
                    <select id="add-category" name="category" required class="modal-input" onchange="syncSubcategories(this, 'add-subcategory')">
                        <option value="">Select category</option>
                        {% for cat in categories %}
                            <option value="{{ cat }}">{{ cat }}</option>
                        {% endfor %}
                    </select>
                </label>
                <label class="flex flex-col gap-1 text-sm">
                    <span class="modal-label">Subcategory (optional)</span>
                    <select id="add-subcategory" name="sub_category" class="modal-input">
                        <option value="">None</option>
                    </select>
                </label>
                <div class="modal-footer">
                    <button type="button" onclick="closeAddModal()" class="modal-button-secondary">Cancel</button>
                    <button type="submit" class="modal-button-primary">Save Ingredient</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Ingredient Modal -->
    <div id="edit-ingredient-modal" class="modal-backdrop hidden">
        <div class="modal-panel max-w-lg">
            <div class="modal-header">
                <h2 class="text-xl font-semibold text-text-normal">Edit Ingredient</h2>
                <button type="button" onclick="closeEditModal()" class="text-text-muted hover:text-text-normal text-2xl leading-none">&times;</button>
            </div>
            <form id="edit-ingredient-form" class="modal-body space-y-4">
                <input type="hidden" id="edit-id" name="id" />
                <label class="flex flex-col gap-1 text-sm">
                    <span class="modal-label">Name</span>
                    <input type="text" id="edit-name" name="name" required class="modal-input" />
                </label>
                <label class="flex flex-col gap-1 text-sm">
                    <span class="modal-label">Category</span>
                    <select id="edit-category" name="category" required class="modal-input" onchange="syncSubcategories(this, 'edit-subcategory')">
                        <option value="" disabled>Select category</option>
                        {% for cat in categories %}
                            <option value="{{ cat }}">{{ cat }}</option>
                        {% endfor %}
                    </select>
                </label>
                <label class="flex flex-col gap-1 text-sm">
                    <span class="modal-label">Subcategory (optional)</span>
                    <select id="edit-subcategory" name="sub_category" class="modal-input">
                        <option value="">None</option>
                    </select>
                </label>
                <div class="modal-footer">
                    <button type="button" onclick="closeEditModal()" class="modal-button-secondary">Cancel</button>
                    <button type="button" onclick="saveEditIngredient()" class="modal-button-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Ingredient Pricing Modal -->
    <div id="price-modal" class="modal-backdrop hidden">
        <div class="modal-panel max-w-2xl">
            <div class="modal-header">
                <h2 class="text-xl font-semibold text-text-normal">Ingredient Pricing</h2>
                <button type="button" onclick="closePriceModal()" class="text-text-muted hover:text-text-normal text-2xl leading-none">&times;</button>
            </div>
            <div class="modal-body space-y-5">
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
                    <div>
                        <p class="text-xs uppercase tracking-wide text-text-muted">Ingredient</p>
                        <p id="price-ingredient-name" class="text-lg font-semibold text-text-normal">Ingredient</p>
                    </div>
                    <div class="text-left sm:text-right">
                        <p class="text-xs uppercase tracking-wide text-text-muted">Latest $/ml</p>
                        <p id="price-latest" class="text-lg font-semibold text-text-normal">—</p>
                    </div>
                </div>

                <div class="rounded-2xl border border-border bg-background-mid/50 p-4 space-y-3">
                    <p class="text-sm text-text-muted">Record a purchase to track price per ml (US volume units supported).</p>
                    <form id="purchase-form" class="grid gap-3 sm:grid-cols-2">
                        <label class="flex flex-col gap-1 text-sm">
                            <span class="modal-label">Date</span>
                            <input type="date" id="purchase-date" required class="modal-input" />
                        </label>
                        <label class="flex flex-col gap-1 text-sm">
                            <span class="modal-label">Location</span>
                            <input type="text" id="purchase-location" class="modal-input" placeholder="Store or website" />
                        </label>
                        <label class="flex flex-col gap-1 text-sm">
                            <span class="modal-label">Size</span>
                            <input type="number" id="purchase-size" class="modal-input" step="0.01" min="0" inputmode="decimal" required />
                        </label>
                        <label class="flex flex-col gap-1 text-sm">
                            <span class="modal-label">Unit</span>
                            <select id="purchase-unit" class="modal-input" required>
                                <option value="">Select unit</option>
                                <option value="ml">ml</option>
                                <option value="l">l</option>
                                <option value="oz">oz</option>
                                <option value="fl oz">fl oz</option>
                                <option value="cup">cup</option>
                                <option value="pt">pt</option>
                                <option value="qt">qt</option>
                                <option value="gal">gal</option>
                                <option value="tbsp">tbsp</option>
                                <option value="tsp">tsp</option>
                            </select>
                        </label>
                        <label class="flex flex-col gap-1 text-sm">
                            <span class="modal-label">Price (USD)</span>
                            <input type="number" id="purchase-price" class="modal-input" step="0.01" min="0" inputmode="decimal" required />
                        </label>
                        <label class="flex flex-col gap-1 text-sm sm:col-span-2">
                            <span class="modal-label">Notes (optional)</span>
                            <input type="text" id="purchase-notes" class="modal-input" placeholder="Bottle size, brand, sale, etc." />
                        </label>
                        <div class="sm:col-span-2 flex justify-end">
                            <button type="submit" class="modal-button-primary">Add Purchase</button>
                        </div>
                    </form>
                </div>

                <div class="space-y-3">
                    <h3 class="text-lg font-semibold text-text-normal">Purchase History</h3>
                    <div id="purchase-list" class="space-y-3"></div>
                    <p id="purchase-empty" class="text-sm text-text-muted hidden">No purchases yet.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        function closeAllModals() {
            document.querySelectorAll('.modal-backdrop').forEach((modal) => {
                modal.classList.add('hidden');
                modal.style.display = 'none';
            });
        }

        function openAddModal() {
            const modal = document.getElementById('add-ingredient-modal');
            if (modal) {
                modal.classList.remove('hidden');
                modal.style.display = 'flex';
                document.getElementById('add-ingredient-form').reset();
                syncSubcategories(document.getElementById('add-category'), 'add-subcategory');
                document.getElementById('add-name').focus();
            }
        }

        function closeAddModal() {
            const modal = document.getElementById('add-ingredient-modal');
            if (modal) {
                modal.classList.add('hidden');
                modal.style.display = 'none';
            }
        }

        function openEditModal(button) {
            const card = button.closest('.ingredient-card');
            if (!card) {
                return;
            }

            const modal = document.getElementById('edit-ingredient-modal');
            if (!modal) {
                return;
            }

            document.getElementById('edit-id').value = card.dataset.id || '';
            document.getElementById('edit-name').value = card.dataset.name || '';
            const categorySelect = document.getElementById('edit-category');
            categorySelect.value = card.dataset.category || '';
            syncSubcategories(categorySelect, 'edit-subcategory', card.dataset.subcategory || '');

            modal.classList.remove('hidden');
            modal.style.display = 'flex';
        }

        function closeEditModal() {
            const modal = document.getElementById('edit-ingredient-modal');
            if (modal) {
                modal.classList.add('hidden');
                modal.style.display = 'none';
            }
        }

        function toggleIngredientClear() {
            const input = document.getElementById('ingredient-filter');
            const clearBtn = document.getElementById('ingredient-filter-clear');
            if (!input || !clearBtn) {
                return;
            }
            const hasValue = input.value.trim().length > 0;
            clearBtn.classList.toggle('invisible', !hasValue);
            clearBtn.classList.toggle('opacity-0', !hasValue);
            clearBtn.classList.toggle('pointer-events-none', !hasValue);
            clearBtn.setAttribute('aria-hidden', String(!hasValue));
        }

        function syncSubcategories(selectEl, targetSelectId, selectedValue = '') {
            const target = document.getElementById(targetSelectId);
            if (!selectEl || !target) {
                return;
            }

            target.innerHTML = '<option value=\"\">None</option>';
            const category = selectEl.value;
            if (!category) {
                return;
            }

            fetch(`/subcategories/${encodeURIComponent(category)}`)
                .then((response) => response.json())
                .then((subcategories) => {
                    subcategories.forEach((sub) => {
                        const option = document.createElement('option');
                        option.value = sub;
                        option.textContent = sub;
                        if (selectedValue && selectedValue === sub) {
                            option.selected = true;
                        }
                        target.appendChild(option);
                    });
                })
                .catch((error) => {
                    console.error('Unable to load subcategories:', error);
                });
        }

        function notify(message, isError = false) {
            if (typeof showToast === "function") {
                showToast(message, isError ? 3500 : 2500);
            } else if (isError) {
                window.alert(message);
            } else {
                console.log(message);
            }
        }

        const moneyFormatter = new Intl.NumberFormat('en-US', {
            style: 'currency',
            currency: 'USD',
            minimumFractionDigits: 2,
            maximumFractionDigits: 2,
        });

        const perMlFormatter = new Intl.NumberFormat('en-US', {
            style: 'currency',
            currency: 'USD',
            minimumFractionDigits: 4,
            maximumFractionDigits: 4,
        });

        let activeIngredientId = null;

        function escapeHtml(value) {
            return String(value || '')
                .replaceAll('&', '&amp;')
                .replaceAll('<', '&lt;')
                .replaceAll('>', '&gt;')
                .replaceAll('"', '&quot;')
                .replaceAll("'", '&#39;');
        }

        function formatQuantity(value) {
            const num = Number(value);
            if (Number.isNaN(num)) {
                return value || '';
            }
            return num.toLocaleString('en-US', { maximumFractionDigits: 2 });
        }

        function openPriceModal(button) {
            const card = button.closest('.ingredient-card');
            if (!card) {
                return;
            }

            const modal = document.getElementById('price-modal');
            if (!modal) {
                return;
            }

            activeIngredientId = card.dataset.id;
            document.getElementById('price-ingredient-name').textContent = card.dataset.name || 'Ingredient';

            const dateInput = document.getElementById('purchase-date');
            if (dateInput && !dateInput.value) {
                dateInput.value = new Date().toISOString().split('T')[0];
            }

            modal.classList.remove('hidden');
            modal.style.display = 'flex';
            fetchPurchaseHistory();
        }

        function closePriceModal() {
            const modal = document.getElementById('price-modal');
            if (modal) {
                modal.classList.add('hidden');
                modal.style.display = 'none';
            }
            activeIngredientId = null;
        }

        async function fetchPurchaseHistory() {
            if (!activeIngredientId) {
                return;
            }

            const list = document.getElementById('purchase-list');
            if (list) {
                list.innerHTML = '<p class="text-sm text-text-muted">Loading...</p>';
            }

            try {
                const response = await fetch(`/ingredient-purchases/${activeIngredientId}`);
                if (!response.ok) {
                    throw new Error(`Unable to load purchases (status ${response.status}).`);
                }
                const purchases = await response.json();
                renderPurchaseHistory(Array.isArray(purchases) ? purchases : []);
            } catch (error) {
                console.error('Unable to load purchases:', error);
                notify('Unable to load purchase history. Please try again.', true);
            }
        }

        function renderPurchaseHistory(purchases) {
            const list = document.getElementById('purchase-list');
            const empty = document.getElementById('purchase-empty');
            const latestEl = document.getElementById('price-latest');

            if (!list || !empty || !latestEl) {
                return;
            }

            list.innerHTML = '';
            if (!purchases.length) {
                empty.classList.remove('hidden');
                latestEl.textContent = '—';
                return;
            }

            empty.classList.add('hidden');
            const latest = purchases.find((purchase) => purchase.price_per_ml);
            if (latest && latest.price_per_ml) {
                latestEl.textContent = `${perMlFormatter.format(latest.price_per_ml)}/ml`;
            } else {
                latestEl.textContent = '—';
            }

            purchases.forEach((purchase) => {
                const location = purchase.location ? ` • ${escapeHtml(purchase.location)}` : '';
                const sizeLabel = `${formatQuantity(purchase.size_value)} ${escapeHtml(purchase.size_unit || '')}`.trim();
                const priceLabel = purchase.price ? moneyFormatter.format(purchase.price) : '—';
                const perMlLabel = purchase.price_per_ml ? `${perMlFormatter.format(purchase.price_per_ml)}/ml` : '—';
                const notesMarkup = purchase.notes
                    ? `<p class="text-xs text-text-muted mt-1">${escapeHtml(purchase.notes)}</p>`
                    : '';

                list.insertAdjacentHTML(
                    'beforeend',
                    `
                    <div class="rounded-2xl border border-border bg-background-mid/60 p-4">
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
                            <div>
                                <p class="text-sm font-semibold text-text-normal">${escapeHtml(purchase.purchase_date || '')}${location}</p>
                                <p class="text-xs text-text-muted">${escapeHtml(sizeLabel)} • ${priceLabel}</p>
                                ${notesMarkup}
                            </div>
                            <div class="flex items-center gap-3 justify-between sm:flex-col sm:items-end">
                                <p class="text-sm font-semibold text-text-normal">${perMlLabel}</p>
                                <button
                                    type="button"
                                    class="text-xs text-red-400 hover:text-red-300 transition"
                                    onclick="deletePurchase(${purchase.id})"
                                >
                                    Delete
                                </button>
                            </div>
                        </div>
                    </div>
                    `
                );
            });
        }

        async function deletePurchase(purchaseId) {
            if (!purchaseId) {
                return;
            }
            try {
                const response = await fetch(`/ingredient-purchase/${purchaseId}`, { method: 'DELETE' });
                if (!response.ok) {
                    throw new Error(`Unable to delete purchase (status ${response.status}).`);
                }
                fetchPurchaseHistory();
                notify('Purchase deleted.');
            } catch (error) {
                console.error('Unable to delete purchase:', error);
                notify('Unable to delete purchase. Please try again.', true);
            }
        }

        async function handlePurchaseSubmit(event) {
            event.preventDefault();
            if (!activeIngredientId) {
                return;
            }

            const payload = {
                purchase_date: document.getElementById('purchase-date')?.value || '',
                location: document.getElementById('purchase-location')?.value || '',
                size_value: document.getElementById('purchase-size')?.value || '',
                size_unit: document.getElementById('purchase-unit')?.value || '',
                price: document.getElementById('purchase-price')?.value || '',
                notes: document.getElementById('purchase-notes')?.value || '',
            };

            try {
                const response = await fetch(`/ingredient-purchases/${activeIngredientId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload),
                });
                if (!response.ok) {
                    const data = await response.json().catch(() => ({}));
                    throw new Error(data.message || 'Unable to add purchase.');
                }
                document.getElementById('purchase-size').value = '';
                document.getElementById('purchase-price').value = '';
                document.getElementById('purchase-notes').value = '';
                fetchPurchaseHistory();
                notify('Purchase added.');
            } catch (error) {
                console.error('Unable to add purchase:', error);
                notify(error.message || 'Unable to add purchase. Please try again.', true);
            }
        }

        function removeCardById(id) {
            const card = document.querySelector(`.ingredient-card[data-id="${id}"]`);
            if (card && card.parentElement) {
                card.parentElement.removeChild(card);
            }

            const remainingCards = document.querySelectorAll('.ingredient-card');
            const emptyState = document.getElementById('ingredients-empty');
            if (emptyState) {
                emptyState.classList.toggle('hidden', remainingCards.length !== 0);
            }
            filterIngredientCards();
        }

        function updateCardFromForm(data) {
            const card = document.querySelector(`.ingredient-card[data-id=\"${data.id}\"]`);
            if (!card) {
                return;
            }
            card.dataset.name = data.name;
            card.dataset.category = data.category;
            card.dataset.subcategory = data.sub_category || '';
            card.querySelector('h3').textContent = data.name;
            card.querySelector('span').textContent = data.category || 'Uncategorized';
            const subText = card.querySelector('p');
            if (subText) {
                subText.innerHTML = `<span class=\"font-medium text-text-normal\">Subcategory:</span> ${data.sub_category || 'None'}`;
            }
        }

        function deleteIngredient(button) {
            const card = button.closest(".ingredient-card");
            if (!card) {
                return;
            }
            const id = card.dataset.id;
            if (!id) {
                return;
            }

            fetch(`/delete_possible_ingredient/${id}`, { method: "DELETE" })
                .then((response) => {
                    if (!response.ok) {
                        throw new Error(`Request failed with status ${response.status}`);
                    }
                    removeCardById(id);
                    filterIngredientCards();
                    notify(`${card.dataset.name || "Ingredient"} removed from master list.`);
                })
                .catch((error) => {
                    console.error("Unable to delete ingredient:", error);
                    notify("Unable to delete ingredient. Please try again.", true);
                });
        }

        function saveEditIngredient() {
            const form = document.getElementById('edit-ingredient-form');
            if (!form) {
                return;
            }
            const id = form.querySelector('#edit-id').value;
            if (!id) {
                return;
            }

            const formData = new FormData(form);

            fetch(`/update_possible_ingredient/${id}`, {
                method: 'POST',
                body: formData,
            })
                .then((response) => {
                    if (!response.ok) {
                        return response.json().then((payload) => {
                            throw new Error(payload.message || 'Unable to update ingredient.');
                        });
                    }
                    return response.json();
                })
                .then(() => {
                    updateCardFromForm({
                        id,
                        name: formData.get('name') || '',
                        category: formData.get('category') || '',
                        sub_category: formData.get('sub_category') || '',
                    });
                    closeEditModal();
                    filterIngredientCards();
                    notify('Ingredient updated.');
                })
                .catch((error) => {
                    console.error('Unable to update ingredient:', error);
                    notify(error.message || 'Unable to update ingredient. Please try again.', true);
                });
        }

        function filterIngredientCards() {
            const filterValue = (document.getElementById('ingredient-filter')?.value || '').trim().toLowerCase();
            const cards = document.querySelectorAll('.ingredient-card');
            let visibleCount = 0;

            cards.forEach((card) => {
                const name = (card.dataset.name || '').toLowerCase();
                const category = (card.dataset.category || '').toLowerCase();
                const subcategory = (card.dataset.subcategory || '').toLowerCase();
                const shouldShow =
                    !filterValue ||
                    name.includes(filterValue) ||
                    category.includes(filterValue) ||
                    subcategory.includes(filterValue);
                card.classList.toggle('hidden', !shouldShow);
                if (shouldShow) {
                    visibleCount += 1;
                }
            });

            const emptyState = document.getElementById('ingredients-empty');
            if (emptyState) {
                emptyState.classList.toggle('hidden', visibleCount !== 0);
            }
        }

        function resetIngredientFilter() {
            const filterInput = document.getElementById('ingredient-filter');
            if (filterInput) {
                filterInput.value = '';
            }
            filterIngredientCards();
            toggleIngredientClear();
        }

        document.addEventListener('DOMContentLoaded', () => {
            filterIngredientCards();
            toggleIngredientClear();
            const purchaseForm = document.getElementById('purchase-form');
            if (purchaseForm) {
                purchaseForm.addEventListener('submit', handlePurchaseSubmit);
            }
        });

        window.openAddModal = openAddModal;
        window.closeAddModal = closeAddModal;
        window.openEditModal = openEditModal;
        window.closeEditModal = closeEditModal;
        window.openPriceModal = openPriceModal;
        window.closePriceModal = closePriceModal;
        window.deletePurchase = deletePurchase;
        window.deleteIngredient = deleteIngredient;
        window.saveEditIngredient = saveEditIngredient;
        window.filterIngredientCards = filterIngredientCards;
        window.resetIngredientFilter = resetIngredientFilter;
        window.syncSubcategories = syncSubcategories;
    </script>
    </div>
{% endblock %}
